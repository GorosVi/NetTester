Система определения задержки пакетов в ЛВС
=========================================

Описание
--------

Основная задача системы - измерить задержку между отправкой некоторого пакета в локальную вычислительную
сеть и его приёмом, при условии, что получатель пакетов отправляет их обратно на интерфейс отправителя.
Для измерения этой задержки система отправляет получателю сетевые пакеты с меткой времени отправки и
для принятых пакетов вычисляет разность значений времени.

Для упрощения реализации системы она обрабатывает только свои пакеты, при приёме остальной трафик
игнорируется. Пакет, пришедший на интерфейс системы считается "своим", когда он адресован на IP-адрес
системы, является UDP-пакетом и направлен на порт, определённый в конфигурации. Такие пакеты используются
для измерения времени задержки пакета в пути.

Для измерения времени прохождения пакетов в сети система генерирует пакеты с определённой частотой
для создания заданной пользователем нагрузки. Параметры, необходимые для создания пакета, задаются
пользователем, а поле данных заполняется системой автоматически. Поле данных содержит информацию о
времени отправки пакета, поэтому в возвращаемом пакете оно должно быть в неизменном виде.

Полученные значения задержки передаются управляющей программе системы, которая записывает результаты
в файл (по значению на строку), или выдаёт на stdout. Отдельные потерянные пакеты не учитываются, но
система считает количество полученных пакетов после завершения тестирования.

Система разрабатывается с поддержкой протокола IPv4 для сетевого уровня и UDP для транспортного.
Применяемый физический интерфейс - 1 Gigabit Ethernet.
Для упрощения аппаратной приёмной части устройства для измерения задержки принимаются только
нефрагментированные пакеты.


Параметры
---------

Для запуска системы пользователю нужно вызвать управляющую программу и передать ей следующие параметры:
* Уровень нагрузки (задаётся в виде требуемого битрейта исходящего трафика в кбит/c)
* Количество отправляемых пакетов
* Размер отправляемого пакета (задаётся в байтах)
* IP-SRC - IP-адрес отправителя
* IP-DEST - IP-адрес получателя
* MAC-SRC - MAC-адрес отправителя
* MAC-DEST - MAC-адрес получателя
* PORT-SRC - UDP-порт отправителя
* PORT-DEST - UDP-порт получателя

Параметры задаются в виде аргументов командной строки, передаваемых при запуске управляющего ПО.


Допустимые значения параметров
------------------------------

При обработке входных значений система проверяет корректность их значений
Данные ограничения определяются форматом входных данных или особенностями работы системы. Основные
ограничения, связанные с ними, описаны подробнее в следующем разделе.
* IP-SRC, IP-DST - корректный IP адрес в формате 111.222.33.4, IP-SRC - адрес сетевого интерфейса,
    с которого отправляются тестовые пакеты.
* MAC-SRC, MAC-DST - корректный MAC адрес в формате 00:AA:BB:CC:DD:EE, MAC-SRC - адрес сетевого
    интерфейса, с которого отправляются тестовые пакеты.
* Размер отправляемого пакета - значение от 46 до 1500 (максимальный размер MTU одного фрейма)
* Уровень нагрузки не должен быть больше максимально достижимой скорости физического интерфейса
  (если указанное значение всё-таки превысить - система отработает с максимальной рабочей
  скоростью, и сообщит, что быстрее не смогла). Допускаются значения в диапазоне 1 - 1000000 кБит/с.
* PORT-SRC, PORT-DEST - значение от 0 до 65535. Права доступа в операционных системах тестирующего
  устройства и устройства назначения могут вызвать дополнительные ограничения этого диапазона.
* Количество отправляемых пакетов - значение от 0 до максимального значения UINT32.


Примерный алгоритм работы
-------------------------

При генерации пакета ПО системы создаёт заголовок пакета, состоящий из заголовков протоколов
IPv4 и UDP. Аппаратный модуль дополняет данный заголовок локальным времени отправки пакета и заполнителем
для создания пакета необходимой длины, и отправляет получившийся пакет. Поле контрольной суммы для UDP
протокола система не рассчитывает, так как значение в нём зависит от данных заполнителя пакета.

Время, проведённое пакетом в пути, измеряется с точностью до 0.1 мс. Соответственно, отсчёт времени
ведётся со скоростью 10 кГц и для того, чтобы покрыть 30-секундную задержку (будем её считать
максимально возможной) потребуется число, превышающее 2^16. Значит, отсчитываемое системой время будет
записано в значение разрядностью 32 бит (4 байта).

Это значение оборачивается в UDP-пакет, заголовок которого занимает 8 байт.
  С данными, минимальная длина пакета составит 12 байт.

UDP-пакет оборачивается в IPv4-пакет, заголовок которого занимает 20 байт.
  С данными, минимальная длина пакета составит 32 байта.

Также, минимальная длина пакета ограничена форматом фрейма Ethernet II, и равна 46 байт.

Максимальный размер пакета определяется MTU для фрейма, и для Ethernet II будет равен 1500 байт. (jumbo?)

После отправки первого тестового пакета система ищет среди принимаемых пакетов те, которые были
отправлены целевым устройством обратно, и вычисляет разность между локальным временем приёма пакета и
временем его отправки. Полученное значение и есть время задержки прохождения пакета в сети.