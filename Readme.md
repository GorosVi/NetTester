Система определения задержки пакетов в ЛВС
=========================================

Описание
--------

Система производит тестирование задержки отправляемых в локальной вычислительной сети пакетов, при
условии, что тестируемое устройство принимает пакеты, отправляемые системой и пересылает их обратно
на сетевой интерфейс системы.

Система реализована как прозрачный мост между сетевым драйвером управляющей ОС linux
и физическим сетевым интерфейсом устройства, на котором ОС работает. Если сетевой пакет, пришедший на
физический интерфейс устройства, является UDP-пакетом и направлен на порт PORT-SRC, то он используется
для измерения времени пакета в пути и дропается системой. Остальные пакеты передаются сетевому драйверу
управляющей ОС.

Для измерения времени прохождения пакетов в сети система генерирует пакеты с определённой частотой
для создания заданной пользователем нагрузки. Параметры, необходимые для создания пакета, задаются
пользователем, а поле данных заполняется системой автоматически. Поле данных содержит информацию о
времени отправки пакета, поэтому в возвращаемом пакете оно должно быть в неизменном виде.

Система разрабатывается с поддержкой протокола IPv4 для сетевого уровня и UDP для транспортного.
Применяемый физический интерфейс - 1 Gigabit Ethernet.
Для упрощения аппаратной приёмной части устройства для измерения задержки принимаются только
нефрагментированные пакеты.


Параметры
---------

Система состоит из управляющей программы и аппаратного модуля. Для запуска системы пользователю
нужно вызвать управляющую программу и передать ей следующие параметры:

* Уровень нагрузки (задаётся в виде требуемого битрейта исходящего трафика в кбит/c)
* Количество отправляемых пакетов
* Размер отправляемого пакета (задаётся в байтах)
* IP-SRC - IP-адрес отправителя
* IP-DEST - IP-адрес получателя
* MAC-SRC - MAC-адрес отправителя
* MAC-DEST - MAC-адрес получателя
* PORT-SRC - UDP-порт отправителя
* PORT-DEST - UDP-порт получателя

Параметры задаются в виде аргументов командной строки, передаваемых при запуске управляющего ПО.


Примерный алгоритм работы
-------------------------

При генерации пакета ПО системы создаёт типовой заголовок пакета, состоящий из заголовков протоколов
IPv4 и UDP. Аппаратный модуль дополняет данный заголовок локальным времени отправки пакета и заполнителем
для создания пакета необходимой длины, и отправляет получившийся пакет. Поле контрольной суммы для UDP
протокола система не рассчитывает, так как значение в нём зависит от данных заполнителя пакета.

Время, проведённое пакетом в пути, измеряется с точностью до 0.1 мс. Соответственно, отсчёт времени
ведётся со скоростью 10 кГц и для того, чтобы покрыть 30-секундную задержку (будем её считать
максимально возможной) потребуется число, превышающее 2^16. Значит, отсчитываемое системой время будет
записано в значение разрядностью 32 бит (4 байта).

Это значение оборачивается в UDP-пакет, заголовок которого занимает 8 байт.
  С данными, минимальная длина пакета составит 12 байт.

UDP-пакет оборачивается в IPv4-пакет, заголовок которого занимает 20 байт.
  С данными, минимальная длина пакета составит 32 байта.

Также, минимальная длина пакета ограничена форматом фрейма Ethernet II, и равна 46 байт.

Максимальный размер пакета определяется MTU для фрейма, и для Ethernet II будет равен 1500 байт. (jumbo?)

После отправки первого тестового пакета система ищет среди принимаемых пакетов те, которые были
отправлены целевым устройством обратно, и вычисляет разность между локальным временем приёма пакета и
временем его отправки. Полученное значение и есть время задержки прохождения пакета в сети.

Полученные значения задержки передаются управляющей программе системы, которая записывает результаты
в файл (по значению на строку), или выдаёт на stdout. Отдельные потерянные пакеты не учитываются, но
система считает их количество при завершении тестирования.


Допустимые значения параметров
------------------------------

* IP-SRC, IP-DST - корректный IP адрес в формате 111.222.33.4, IP-SRC - адрес сетевого интерфейса,
    с которого отправляются тестовые пакеты.
* MAC-SRC, MAC-DST - корректный MAC адрес в формате 00:AA:BB:CC:DD:EE, MAC-SRC - адрес сетевого
    интерфейса, с которого отправляются тестовые пакеты.
* Размер отправляемого пакета - значение от 46 до 1500 (максимальный размер MTU одного фрейма)
* Уровень нагрузки не должен быть больше максимально достижимой скорости физического интерфейса
  (если указанное значение всё-таки превысить - система отработает с максимальной рабочей
  скоростью, и сообщит, что быстрее не смогла). Допускаются значения в диапазоне 1 - 1000000 кБит/с.
* PORT-SRC, PORT-DEST - значение от 0 до 65535. Права доступа в операционных системах тестирующего
  устройства и устройства назначения могут вызвать дополнительные ограничения этого диапазона.
* Количество отправляемых пакетов - значение от 0 до максимального значения UINT32.